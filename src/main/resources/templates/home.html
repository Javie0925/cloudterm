<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link href="css/xterm.min.css" rel="stylesheet" type="text/css"/>
    <link href="css/fullscreen.min.css" rel="stylesheet" type="text/css"/>
    <link rel="shortcut icon" href="favicon.png">
    <title>Cloud Terminal</title>

    <link rel="stylesheet" href="js/layui/css/layui.css" media="all">
    <script src="js/layui/layui.js"></script>

    <script src="js/jquery.min.js"></script>
    <script src="js/xterm.min.js"></script>
    <script src="js/fullscreen.min.js"></script>
    <script src="js/main.js"></script>
    <style>
        /* style of scrollbar */
        ::-webkit-scrollbar {
            width: 6px;   /* width: for crosswise  height: vertical */
            background: black;
        }
        /* style of slot */
        ::-webkit-scrollbar-track {
            -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.3);    /* seldom used */
            border-radius: 3px;
        }
        /* scrollbar thumb */
        ::-webkit-scrollbar-thumb {
            border-radius: 3px;
            height: 100px;
            background-color: #8b8b8b;
        }
    </style>
</head>
<body>
<h2 style="position: fixed;z-index: 10000;color: white;top: 2%;right: 2%;">
    <strong>Cloud Terminal</strong>
</h2>
<div style="position: fixed;z-index: 10000;color: white;top: 0;right: 50%;">
    <i id="tips" class="layui-icon layui-icon-down"
       style="font-size: 25px; color: #ffffff; font-weight: bolder;opacity: 0.6"></i>
</div>
<div id="terminal"></div>
<script>
    let theme = {
        bgColor: '#c15050'
    };
    layui.use(['util'], function () {
        let util = layui.util, $ = layui.$, layer = layui.layer;
        //fixbar
        util.fixbar({
            bar1: {
                title: "home",
                icon: '&#xe68e;'
            }
            , bar2: {
                title: "server list",
                icon: '&#xe653;'
            }
            , bar3: {
                icon: '&#xe639;',
                title: "clear"
            }
            , css: {right: 20, bottom: 50}
            , bgcolor: theme.bgColor
            , click: function (type) {
                if (type === 'bar1') {
                    location.replace(location.origin);
                } else if (type === 'bar2') {
                    let that = this;
                    //多窗口模式，层叠置顶
                    layer.open({
                        type: 2 //page
                        , title: 'Server List'
                        , area: ['60%', '70%'] // [width,height]
                        , shade: [0.8, '#393D49']
                        , maxmin: true
                        , content: '/?page=serverList'
                        , zIndex: layer.zIndex //重点1
                        , success: function (layero, index) {
                            layer.setTop(layero); // keep the selected window on top
                            //recode index
                            layer.escIndex = layer.escIndex || [];
                            layer.escIndex.unshift(index);
                            //if being selected, put current layer index to top
                            layero.on('mousedown', function () {
                                var _index = layer.escIndex.indexOf(index);
                                if (_index !== -1) {
                                    layer.escIndex.splice(_index, 1); //delete old index
                                }
                                layer.escIndex.unshift(index); //put index to the head
                            });
                        }
                        , end: function () {
                            //update index
                            if (typeof layer.escIndex === 'object') {
                                layer.escIndex.splice(0, 1);
                            }
                        }
                    });
                } else if (type === 'bar3') {
                    let command = 'clear || cls \r\n';
                    window.ws.send(
                        action('TERMINAL_COMMAND', {
                            command,
                        })
                    );
                }
            }
        });

        $("#tips").click(function (event) {
            layer.open({
                type: 2 //page
                , title: 'Cheat Sheets'
                , area: ['60%', '70%'] // [width,height]
                , shade: [0.8, '#393D49']
                , maxmin: true
                , content: '/?page=cheatSheet'
                , zIndex: layer.zIndex //重点1
                , anim: 1
                , success: function (layero, index) {
                    layer.setTop(layero); // keep the selected window on top
                    //recode index
                    layer.escIndex = layer.escIndex || [];
                    layer.escIndex.unshift(index);
                    //if being selected, put current layer index to top
                    layero.on('mousedown', function () {
                        var _index = layer.escIndex.indexOf(index);
                        if (_index !== -1) {
                            layer.escIndex.splice(_index, 1); //delete old index
                        }
                        layer.escIndex.unshift(index); //put index to the head
                    });
                }
                , end: function () {
                    //update index
                    if (typeof layer.escIndex === 'object') {
                        layer.escIndex.splice(0, 1);
                    }
                }
            });
        })

        // esc key event
        $(document).on('keyup', function (e) {
            if (e.keyCode === 27) {
                layer.close(layer.escIndex ? layer.escIndex[0] : 0);
            }
        });
    });
    $("#tips").hover(function (event) {
        $(event.target).css("opacity", 1).css("color", theme.bgColor)
    }, function (event) {
        $(event.target).css("opacity", 0.6).css("color", "#ffffff")
    })
</script>
</body>
</html>
